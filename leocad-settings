#!/bin/bash

# Author: Nathanel Titane - nathanel.titane@gmail.com

# leocad settings #

# dependencies --------------------------------------------------------------- # 

source console

# variables ------------------------------------------------------------------ #

binary_directory="/usr/bin"

home="/home/${SUDO_USER:-$USER}"
configuration_directory="$home/.config"
local_applications_directory="$home/.local/share/applications"
system_applications_directory="/usr/share/applications"

ldraw_directory="/media/MEGA/Lego"
ldraw_parts_directory="/media/MEGA/Lego/ldraw/"

leocad_directory="$configuration_directory/LeoCAD Software"

# settings #

if [ ! -d "$leocad_directory" ]
then
	mkdir -p "$leocad_directory"
fi

cd "$leocad_directory" || exit

console.info "Writing configuration."

cat << 'FILE' > "$leocad_directory"/LeoCAD.conf
[Defaults]
AmbientColor=-1
Author=Nathanel Titane - nathanel.titane@gmail.com - All rights reserved
BackgroundColor=-14080477
BackgroundTexture=
BackgroundTile=0
BackgroundType=0
FogColor=-1
FogDensity="@Variant(\0\0\0\x87=\xcc\xcc\xcd)"
FogEnabled=0
GradientColor1=-1
GradientColor2=-1

[MainWindow]
Geometry="@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\0\0\0\0\0\0\0\0\bo\0\0\x5\x9f\0\0\0\0\0\0\0\x14\0\0\x2\a\0\0\x3;\0\0\0\0\x2\0\0\0\bp\0\0\0\0\0\0\0\x1d\0\0\bo\0\0\x5\x9f)"
PartSelectionSplitter=@Variant(\0\0\0\x7f\0\0\0\vQList<int>\0\0\0\0\x2\0\0\x1\xe2\0\0\x2\x82)
State=@ByteArray(\0\0\0\xff\0\0\0\0\xfd\0\0\0\x2\0\0\0\x1\0\0\x1\x17\0\0\x4G\xfc\x2\0\0\0\x1\xfb\0\0\0\x1a\0\x43\0o\0l\0o\0r\0s\0T\0o\0o\0l\0\x62\0\x61\0r\0\0\0\0\x1e\0\0\x4G\0\0\0\xa2\x1\0\0\x3\0\0\0\x3\0\0\bp\0\0\x1\xa5\xfc\x1\0\0\0\x3\xfb\0\0\0\"\0P\0r\0o\0p\0\x65\0r\0t\0i\0\x65\0s\0T\0o\0o\0l\0\x62\0\x61\0r\x1\0\0\0\0\0\0\x2\"\0\0\0\xe1\x1\0\0\x3\xfb\0\0\0\x1e\0T\0i\0m\0\x65\0l\0i\0n\0\x65\0T\0o\0o\0l\0\x62\0\x61\0r\x1\0\0\x2#\0\0\x1\xe3\0\0\0`\x1\0\0\x3\xfb\0\0\0\x18\0P\0\x61\0r\0t\0s\0T\0o\0o\0l\0\x62\0\x61\0r\x1\0\0\x4\a\0\0\x4i\0\0\0\xd7\x1\0\0\x3\0\0\bp\0\0\x3\xc6\0\0\0\x4\0\0\0\x4\0\0\0\b\0\0\0\b\xfc\0\0\0\x4\0\0\0\x1\0\0\0\x3\0\0\0\x1e\0S\0t\0\x61\0n\0\x64\0\x61\0r\0\x64\0T\0o\0o\0l\0\x62\0\x61\0r\x2\0\0\0\0\xff\xff\xff\xff\0\0\0\0\0\0\0\0\0\0\0\x18\0T\0o\0o\0l\0s\0T\0o\0o\0l\0\x62\0\x61\0r\x2\0\0\0\0\xff\xff\xff\xff\0\0\0\0\0\0\0\0\0\0\0\x16\0T\0i\0m\0\x65\0T\0o\0o\0l\0\x62\0\x61\0r\x2\0\0\0\0\xff\xff\xff\xff\0\0\0\0\0\0\0\0\0\0\0\x2\0\0\0\0\0\0\0\x2\0\0\0\0\0\0\0\x2\0\0\0\0)

[POVRay]
LGEOPath=
Path=

[Settings]
AASamples=1
AllowLOD=1
AutoLoadMostRecent=0

Categories="@ByteArray(
Animal=^%Animal & !(%= | %_ | ^Pattern | ^Sticker)
Antenna=^%Antenna & !(%= | %_ | ^Pattern | ^Sticker)
Arch=^%Arch & !(%= | %_ | ^Pattern | ^Sticker)
Arm=^%Arm & !(%= | %_ | ^Pattern | ^Sticker)
Ball=^%Ball & !(%= | %_ | ^Pattern | ^Sticker)
Bar=^%Bar & !(%= | %_ | ^Pattern | ^Sticker)
Barrel=^%Barrel & !(%= | %_ | ^Pattern | ^Sticker)
Baseplate=^%Baseplate | ^%Platform & !(%= | %_ | ^Pattern | ^Sticker)
Boat=^%Boat & !(%= | %_ | ^Pattern | ^Sticker)
Bone=^%Bone & !(%= | %_ | ^Pattern | ^Sticker)
Bracket=^%Bracket & !(%= | %_ | ^Pattern | ^Sticker)
Brick=^%Brick & !(%= | %_ | ^Pattern | ^Sticker)
Car=^%Car & !(%= | %_ | ^Pattern | ^Sticker)
Castle=^%Castle & !(%= | %_ | ^Pattern | ^Sticker)
Claw=^%Claw & !(%= | %_ | ^Pattern | ^Sticker)
Cockpit=^%Cockpit & !(%= | %_ | ^Pattern | ^Sticker)
Cone=^%Cone & !(%= | %_ | ^Pattern | ^Sticker)
Constraction=^%Constraction & !(%= | %_ | ^Pattern | ^Sticker)
Container=^%Container | ^%Box | ^%Bucket | ^%Handle | ^%Storage & !(%= | %_ | ^Pattern | ^Sticker)
Cylinder=^%Cylinder & !(%= | %_ | ^Pattern | ^Sticker)
Die=^%Die & !(%= | %_ | ^Pattern | ^Sticker)
Dish=^%Dish & !(%= | %_ | ^Pattern | ^Sticker)
Door=^%Door | ^%Freestyle | ^%Gate | ^%Garage | ^%Roller & !(%= | %_ | ^Pattern | ^Sticker)
Electric=^%Electric & !(%= | %_ | ^Pattern | ^Sticker)
Fence=^%Fence & !(%= | %_ | ^Pattern | ^Sticker)
Flag=^%Flag | ^%Flagpost & !(%= | %_ | ^Pattern | ^Sticker)
Glass=^%Glass & !(%= | %_ | ^Pattern | ^Sticker)
Hemisphere=^%Hemisphere | ^%Dome & !(%= | %_ | ^Pattern | ^Sticker)
Hinge=^%Hinge & !(%= | %_ | ^Pattern | ^Sticker)
Hook=^%Hook & !(%= | %_ | ^Pattern | ^Sticker)
Hose=^%Hose & !(%= | %_ | ^Pattern | ^Sticker)
Magnet=^%Magnet & !(%= | %_ | ^Pattern | ^Sticker)
Microfig=^%Microfig & !(%= | %_ | ^Pattern | ^Sticker)
Minifig=^%Minifig & !(%= | %_ | ^Pattern | ^Sticker)
Monorail=^%Monorail & !(%= | %_ | ^Pattern | ^Sticker)
Motor=^%Motor & !(%= | %_ | ^Pattern | ^Sticker)
Panel=^%Panel & !(%= | %_ | ^Pattern | ^Sticker)
Plant=^%Plant & !(%= | %_ | ^Pattern | ^Sticker)
Plate=^%Plate & !(%= | %_ | ^Pattern | ^Sticker)
POV-Ray=^%Pov | ^%POV & !(%= | %_ | ^Pattern | ^Sticker)
Rack=^%Rack & !(%= | %_ | ^Pattern | ^Sticker)
Roof=^%Roof & !(%= | %_ | ^Pattern | ^Sticker)
Rubber=^%Rubber & !(%= | %_ | ^Pattern | ^Sticker)
Sign=^%Roadsign | ^%Signpost & !(%= | %_ | ^Pattern | ^Sticker)
Slope=^%Slope & !(%= | %_ | ^Pattern | ^Sticker)
Space=^%Space & !(%= | %_ | ^Pattern | ^Sticker)
Sticker=^%Sticker & !(%= | %_ | ^Pattern | ^Sticker)
Street=^%Streetlight | ^%Lamppost & !(%= | %_ | ^Pattern | ^Sticker)
String=^%String & !(%= | %_ | ^Pattern | ^Sticker)
Support=^%Support & !(%= | %_ | ^Pattern | ^Sticker)
Technic=^%Technic & !(%= | %_ | ^Pattern | ^Sticker)
Tile=^%Tile & !(%= | %_ | ^Pattern | ^Sticker)
Train=^%Train & !(%= | %_ | ^Pattern | ^Sticker)
Turntable=^%Turntable & !(%= | %_ | ^Pattern | ^Sticker)
Vehicle=^%Bike | ^%Canvas | ^%Conveyor | ^%Crane | ^%Excavator | ^%Exhaust | ^%Forklift | ^%Grab Jaw | ^%Jack | ^%Jet | ^%Landing | ^%Motorcycle | ^%Plane | ^%Propellor | ^%Tail | ^%Tipper | ^%Tractor | ^%Trailer | ^%Vehicle | ^%Winch & !(%= | %_ | ^Pattern | ^Sticker)
Wedge=^%Wedge & !(%= | %_ | ^Pattern | ^Sticker)
Window=^%Window & !(%= | %_ | ^Pattern | ^Sticker)
Windscreen=^%Windscreen & !(%= | %_ | ^Pattern | ^Sticker)
Wing=^%Wing & !(%= | %_ | ^Pattern | ^Sticker)
Tyre=^%Tyre & !(%= | %_ | ^Pattern | ^Sticker | Wheel)
Wheel=^%Wheel & !(%= | %_ | ^Pattern | ^Sticker | Tyre)
)"

CheckUpdates=0
ColorConfig=
DrawAxes=0
DrawEdgeLines=1
FadeSteps=0
FixedAxes=1
ForceGlobalTransforms=1
GridLineColor=0
GridLineSpacing=2
GridLines=0
GridStudColor=0
GridStuds=0
Language=
LightingMode=0
LineWidth=@Variant(\0\0\0\x87?\0\0\0)
MinifigSettings=
MouseSensitivity=10
MouseShortcuts="Pan=3", "Orbit=2"
PartsLibrary=/media/MEGA/Lego/ldraw.zip
PartsListFixedColor=71
PartsListIcons=96
ProjectsPath=/media/MEGA/Lego/models
RecentFile1=
RecentFile2=
RecentFile3=
RecentFile4=
RestoreTabLayout=0
ShadingMode=1

Shortcuts="@ByteArray(
File.New=Ctrl+N
File.Open=Ctrl+O
File.Merge=Ctrl+M
File.Save=Ctrl+S
File.SaveAs=Alt+S
File.SaveImage=Ctrl+Shift+I
File.Export.BrickLink=Ctrl+Alt+B
File.Print=Ctrl+P
File.PrintPreview=Alt+P
File.PrintBOM=Shift+P
File.Exit=Ctrl+Q
Edit.Undo=Ctrl+Z
Edit.Redo=Ctrl+Shift+Z
Edit.Cut=Ctrl+X
Edit.Copy=Ctrl+C
Edit.Paste=Ctrl+V
Edit.Find=Ctrl+F
Edit.SelectAll=Ctrl+A
Edit.SelectNone=Ctrl+Shift+A
Edit.SelectInvert=Ctrl+I
Edit.SelectByName=Ctrl+Shift+N
Edit.SelectByColor=Ctrl+Shift+O
Edit.SelectSingle=Ctrl+Shift+S
Edit.SelectPiece=Ctrl+Shift+P
Edit.SelectColor=Ctrl+Shift+C
Edit.SelectPieceColor=Ctrl+Shift+E
Edit.TransformLocal=Alt+T
Edit.SnapMove.XY0=0
Edit.SnapMove.XY1=1
Edit.SnapMove.XY2=2
Edit.SnapMove.XY3=3
Edit.SnapMove.XY4=4
Edit.SnapMove.XY5=5
Edit.SnapMove.XY6=6
Edit.SnapMove.XY7=7
Edit.SnapMove.XY8=8
Edit.SnapMove.XY9=9
Edit.SnapMove.Z0=Shift+0
Edit.SnapMove.Z1=Shift+1
Edit.SnapMove.Z2=Shift+2
Edit.SnapMove.Z3=Shift+3
Edit.SnapMove.Z4=Shift+4
Edit.SnapMove.Z5=Shift+5
Edit.SnapMove.Z6=Shift+6
Edit.SnapMove.Z7=Shift+7
Edit.SnapMove.Z8=Shift+8
Edit.SnapMove.Z9=Shift+9
Edit.SnapAngle.Angle0=Ctrl+0
Edit.SnapAngle.Angle1=Ctrl+1
Edit.SnapAngle.Angle2=Ctrl+2
Edit.SnapAngle.Angle3=Ctrl+3
Edit.SnapAngle.Angle4=Ctrl+4
Edit.SnapAngle.Angle5=Ctrl+5
Edit.SnapAngle.Angle6=Ctrl+6
Edit.SnapAngle.Angle7=Ctrl+7
Edit.SnapAngle.Angle8=Ctrl+8
Edit.SnapAngle.Angle9=Ctrl+9
Edit.Tool.Insert=Shift+I
Edit.Tool.Light=Ctrl+Alt+L
Edit.Tool.Spotlight=Ctrl+Alt+S
Edit.Tool.Camera=Ctrl+Alt+C
Edit.Tool.Select=Shift+S
Edit.Tool.Move=Shift+M
Edit.Tool.Rotate=Shift+R
Edit.Tool.Delete=Shift+Del
Edit.Tool.Paint=Shift+N
Edit.Tool.ColorPicker=Shift+C
Edit.Tool.Zoom=Shift+Z
Edit.Tool.Pan=Shift+P
Edit.Tool.RotateView=Shift+V
Edit.Tool.Roll=Shift+R
Edit.Tool.ZoomRegion=Shift+Z
Edit.Cancel=Esc
View.Preferences=F12
View.ZoomIn=+
View.ZoomOut=-
View.ZoomExtents=#
View.Viewpoint.Front=F
View.Viewpoint.Back=B
View.Viewpoint.Top=T
View.Viewpoint.Bottom=O
View.Viewpoint.Left=L
View.Viewpoint.Right=R
View.Viewpoint.Home=H
View.Time.First=Alt+Up
View.Time.Previous=Alt+Left
View.Time.Next=Alt+Right
View.Time.Last=Alt+Down
View.Time.InsertBefore=I
View.Time.InsertAfter=A
View.Time.Delete=Alt+Del
View.Time.AddKeys=Alt+K
View.SplitHorizontal=F7
View.SplitVertical=F8
View.RemoveView=F9
View.ResetViews=F10
View.FullScreen=F11
View.CloseCurrentTab=Ctrl+W
View.Shade.Wireframe=Shift+W
View.Shade.Flat=Shift+F
View.Shade.DefaultLights=Shift+L
View.Projection.Perspective=F3
View.Projection.Orthographic=F2
View.ToggleViewSphere=F4
View.FadePreviousSteps=Ctrl+Shift+F
Piece.Insert=Insert
Piece.Delete=Delete
Piece.Duplicate=Ctrl+D
Piece.ResetPivotPoint=Ctrl+#
Piece.ControlPoint.Insert=Ctrl+[
Piece.ControlPoint.Remove=Ctrl+]
Piece.Move.PlusX=Right
Piece.Move.MinusX=Left
Piece.Move.PlusY=Up
Piece.Move.MinusY=Down
Piece.Move.PlusZ=Shift+Up
Piece.Move.MinusZ=Shift+Down
Piece.Rotate.PlusX=Ctrl+Down
Piece.Rotate.MinusX=Ctrl+Up
Piece.Rotate.PlusY=Ctrl+Shift+Left
Piece.Rotate.MinusY=Ctrl+Shift+Right
Piece.Rotate.PlusZ=Ctrl+Left
Piece.Rotate.MinusZ=Ctrl+Right
Piece.ViewSelectedModel=Ctrl+Shift+O
Piece.MoveSelectionToModel=Ctrl+Shift+N
Piece.InlineSelectedModels=Ctrl+Shift+X
Piece.EditSelectedSubmodel=Ctrl+U
Piece.EditEndSubmodel=Ctrl+Shift+U
Piece.Group=Ctrl+G
Piece.Ungroup=Ctrl+Shift+G
Piece.GroupAdd=Ctrl+=
Piece.GroupRemove=Ctrl+-
Piece.GroupEdit=Ctrl+Alt+Shift+G
Piece.HideSelected=Ctrl+H
Piece.HideUnselected=Ctrl+Alt+Shift+H
Piece.UnhideSelected=Ctrl+Shift+H
Piece.UnhideAll=Ctrl+Alt+H
Model.List=Ctrl+Shift+M
Help.About=F1
)"

Snap=2172
StudLogo=0
ViewSphereColor=-12896719
ViewSphereEnabled=1
ViewSphereHighlightColor=-1462723
ViewSphereLocation=1
ViewSphereSize=100
ViewSphereTextColor=-1

[TabLayouts]

[Updates]
LastCheck=

FILE

sudo chmod -R 777 "$leocad_directory"/*

print_architecture="$(dpkg --print-architecture)"

# launcher #

cat <<- FILE > "$system_applications_directory"/leocad.desktop
[Desktop Entry]
Encoding=UTF-8
Name=LeoCAD
GenericName=LDraw Model Editor
Comment=LDraw Model Editor
FILE

if [[ "$print_architecture" = "arm64" ]]
then
	cat <<- FILE >> "$system_applications_directory"/leocad.desktop
	Exec=env LD_PRELOAD=/lib/libandroid-shmem-aarch64.so /usr/bin/leocad
	FILE
else
	cat <<- FILE >> "$system_applications_directory"/leocad.desktop
	Exec=/usr/bin/leocad
	FILE
fi

cat <<- FILE >> "$system_applications_directory"/leocad.desktop
Icon=leocad
Terminal=false
Type=Application
MimeType=application/x-ldraw;application/x-multipart-ldraw;
Categories=Graphics;2DGraphics;3DGraphics;Editor;
FILE

chmod +x "$system_applications_directory"/leocad.desktop

console.success "Done."
echo
